const translations = {
    es: {
        // NAV/GENERAL
        'nav_menu': 'Menú',
        'nav_cart': 'Carrito',
        'nav_account': 'Mi Cuenta',
        'nav_about': 'Sobre Nosotros',
        'nav_admin': 'Administrador',
        'nav_logout': 'Cerrar Sesión',
        'nav_login': 'Iniciar Sesión',
        'nav_language': 'Idioma',
        // TÍTULOS DE PÁGINA
        'title_catalog': 'Deli Pollo - Catálogo',
        'title_about': 'Sobre Nosotros - Deli Pollo',
        'title_cart': 'Carrito - Deli Pollo',
        'title_methods': 'Métodos de Pago - Deli Pollo',
        'title_account': 'Mi Cuenta - Deli Pollo',
        'title_language': 'Idioma - Deli Pollo',
        'title_papas': 'Papas Fritas - Deli Pollo',
        'title_pepsi25': 'Pepsi 2.5L - Deli Pollo',
        'title_pepsi350': 'Pepsi 350ml - Deli Pollo',
        'title_pollo': 'Pollo Asado - Deli Pollo',
        
        // MODALES
        'modal_language_title': 'Seleccionar Idioma',
        'select_language': 'Seleccione su idioma:',
        'btn_save': 'Guardar',
        'btn_cancel': 'Cancelar',
        'modal_login_title': 'Iniciar Sesión',
        'modal_register_title': 'Crear Cuenta',
        'modal_reset_title': 'Restablecer Contraseña',
        'placeholder_username': 'Nombre de usuario',
        'placeholder_email': 'Correo electrónico',
        'placeholder_password': 'Contraseña',
        'placeholder_confirm_password': 'Confirme su contraseña',
        'label_remember': 'Recuérdame',
        'link_forgot_password': '¿Olvidó su contraseña?',
        'link_create_account': '¿No tienes cuenta? Regístrate',
        'btn_enter': 'Ingresar',
        'btn_register': 'Crear Cuenta',
        'btn_reset_password': 'Restablecer Contraseña',
        
        // CARRITO / METODOS DE PAGO
        'cart_title': 'Tu Carrito de Compras',
        'cart_empty': 'Tu carrito está vacío.',
        'cart_total': 'Total:',
        'btn_checkout': 'Realizar Pago',
        'payment_methods_title': 'Métodos de Pago',
        'payment_card_number': 'Número de Tarjeta',
        'payment_card_name': 'Nombre en la Tarjeta',
        'payment_card_expiry': 'Fecha de Vencimiento',
        'payment_card_cvv': 'CVV',
        'btn_add_method': 'Agregar Método de Pago',

        // PÁGINA SOBRE NOSOTROS
        'about_us_header': 'Nuestra Historia',
        'about_us_mission': 'Misión',
        'about_us_vision': 'Visión',
        'about_us_value_1_title': 'Calidad Superior',
        'about_us_value_1_text': 'Ofrecer productos frescos y de la más alta calidad.',
        'about_us_value_2_title': 'Servicio Excepcional',
        'about_us_value_2_text': 'Garantizar una experiencia de compra rápida y amigable.',
        'about_us_value_3_title': 'Innovación Constante',
        'about_us_value_3_text': 'Mejorar continuamente nuestros productos y procesos.',
        
        // PÁGINA DE PRODUCTO
        'product_price': 'Precio:',
        'product_description': 'Descripción del Producto',
        'product_quantity': 'Cantidad:',
        'btn_add_to_cart': 'Añadir al Carrito',
        
        // Textos específicos de productos
        'desc_papas': 'Deliciosas papas fritas, crujientes por fuera y suaves por dentro.',
        'desc_pepsi25': 'Refresco Pepsi de 2.5 litros, perfecto para compartir.',
        'desc_pepsi350': 'Refresco Pepsi de 350 ml, ideal para una porción individual.',
        'desc_pollo': 'Pollo entero asado a la perfección, jugoso y con nuestro toque especial.'
    },
    en: {
        // NAV/GENERAL
        'nav_menu': 'Menu',
        'nav_cart': 'Cart',
        'nav_account': 'My Account',
        'nav_about': 'About Us',
        'nav_admin': 'Administrator',
        'nav_logout': 'Logout',
        'nav_login': 'Login',
        'nav_language': 'Language',
        // PAGE TITLES
        'title_catalog': 'Deli Pollo - Catalog',
        'title_about': 'About Us - Deli Pollo',
        'title_cart': 'Cart - Deli Pollo',
        'title_methods': 'Payment Methods - Deli Pollo',
        'title_account': 'My Account - Deli Pollo',
        'title_language': 'Language - Deli Pollo',
        'title_papas': 'French Fries - Deli Pollo',
        'title_pepsi25': 'Pepsi 2.5L - Deli Pollo',
        'title_pepsi350': 'Pepsi 350ml - Deli Pollo',
        'title_pollo': 'Roasted Chicken - Deli Pollo',

        // MODALS
        'modal_language_title': 'Select Language',
        'select_language': 'Select your language:',
        'btn_save': 'Save',
        'btn_cancel': 'Cancel',
        'modal_login_title': 'Login',
        'modal_register_title': 'Create Account',
        'modal_reset_title': 'Reset Password',
        'placeholder_username': 'Username',
        'placeholder_email': 'Email address',
        'placeholder_password': 'Password',
        'placeholder_confirm_password': 'Confirm password',
        'label_remember': 'Remember me',
        'link_forgot_password': 'Forgot your password?',
        'link_create_account': "Don't have an account? Register",
        'btn_enter': 'Enter',
        'btn_register': 'Create Account',
        'btn_reset_password': 'Reset Password',

        // CART / PAYMENT METHODS
        'cart_title': 'Your Shopping Cart',
        'cart_empty': 'Your cart is empty.',
        'cart_total': 'Total:',
        'btn_checkout': 'Proceed to Checkout',
        'payment_methods_title': 'Payment Methods',
        'payment_card_number': 'Card Number',
        'payment_card_name': 'Name on Card',
        'payment_card_expiry': 'Expiry Date',
        'payment_card_cvv': 'CVV',
        'btn_add_method': 'Add Payment Method',

        // ABOUT US PAGE
        'about_us_header': 'Our History',
        'about_us_mission': 'Mission',
        'about_us_vision': 'Vision',
        'about_us_value_1_title': 'Superior Quality',
        'about_us_value_1_text': 'Offering fresh products of the highest quality.',
        'about_us_value_2_title': 'Exceptional Service',
        'about_us_value_2_text': 'Guaranteeing a fast and friendly shopping experience.',
        'about_us_value_3_title': 'Constant Innovation',
        'about_us_value_3_text': 'Continuously improving our products and processes.',

        // PRODUCT PAGE
        'product_price': 'Price:',
        'product_description': 'Product Description',
        'product_quantity': 'Quantity:',
        'btn_add_to_cart': 'Add to Cart',

        // Specific product texts
        'desc_papas': 'Delicious french fries, crispy outside and soft inside.',
        'desc_pepsi25': 'Pepsi 2.5 liter soda, perfect for sharing.',
        'desc_pepsi350': 'Pepsi 350 ml soda, ideal for an individual serving.',
        'desc_pollo': 'Whole chicken roasted to perfection, juicy and with our special touch.'
    }
};

/**
 * Recupera el idioma guardado, por defecto es 'es'.
 * @returns {string} El código de idioma.
 */
function getLanguage() {
    return localStorage.getItem('language') || 'es';
}

/**
 * Aplica la traducción a los elementos con atributos data-translate.
 * @param {string} language - El código de idioma ('es' o 'en').
 */
function applyLanguage(language) {
    const lang = translations[language] || translations.es;

    // 1. Traducir el Título de la página
    const pageTitleElement = document.querySelector('title');
    const titleKey = pageTitleElement.getAttribute('data-translate');
    if (pageTitleElement && titleKey && lang[titleKey]) {
        pageTitleElement.textContent = lang[titleKey];
    }

    // 2. Traducir textos normales (textContent)
    document.querySelectorAll('[data-translate]').forEach(element => {
        const key = element.getAttribute('data-translate');
        // Evitar que el título se traduzca dos veces
        if (element.tagName.toLowerCase() !== 'title' && lang[key]) {
            element.textContent = lang[key];
        }
    });

    // 3. Traducir placeholders (placeholder attribute)
    document.querySelectorAll('[data-translate-placeholder]').forEach(element => {
        const key = element.getAttribute('data-translate-placeholder');
        if (lang[key]) {
            element.placeholder = lang[key];
        }
    });

    // 4. Actualizar selectores de idioma y el atributo lang del HTML
    document.querySelectorAll('#languageSelect, #languageSelectPage').forEach(select => {
        select.value = language;
    });
    document.documentElement.setAttribute('lang', language);
}

/**
 * Guarda el idioma seleccionado en localStorage y aplica la traducción.
 * @param {string} language - El código de idioma.
 */
function saveLanguage(language) {
    localStorage.setItem('language', language);
    applyLanguage(language);
}

// Inicialización: Aplicar el idioma guardado al cargar la página
document.addEventListener('DOMContentLoaded', function() {
    applyLanguage(getLanguage());
    
    // Asegurar que el listener para el formulario de idioma use la función global
    const languageForm = document.getElementById('languageForm');
    if (languageForm) {
        languageForm.addEventListener('submit', function (e) {
            e.preventDefault();
            const language = document.getElementById('languageSelect').value;
            saveLanguage(language);
            // Asumiendo que showAlert existe en otro script
            if (typeof showAlert === 'function') {
                showAlert('Idioma cambiado correctamente'); 
            }
            const languageModal = bootstrap.Modal.getInstance(document.getElementById('languageModal'));
            if (languageModal) {
                languageModal.hide();
            }
        });
    }
});